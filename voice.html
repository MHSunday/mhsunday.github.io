<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iOS Web Speech æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
            margin: 0;
            padding-bottom: 350px; /* é ç•™ç©ºé–“çµ¦æ§åˆ¶å° */
        }

        h1 { font-size: 20px; margin-bottom: 10px; }
        h2 { font-size: 16px; margin-top: 20px; margin-bottom: 10px; color: #333; }
        p { font-size: 14px; color: #666; margin-bottom: 15px; }

        /* æ¸¬è©¦æŒ‰éˆ•æ¨£å¼ */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        button:active { opacity: 0.8; }
        
        .btn-log { background-color: #3b82f6; } /* è—è‰² */
        .btn-speech { background-color: #8b5cf6; } /* ç´«è‰² */
        .btn-stop { background-color: #ef4444; } /* ç´…è‰² */

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        /* --- è‡ªå®šç¾©æ§åˆ¶å°æ¨£å¼ --- */
        #mobile-debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 300px;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: "Menlo", "Monaco", "Courier New", monospace;
            font-size: 12px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .console-header {
            background-color: #333;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        .console-title { font-weight: bold; color: #fff; }
        .console-actions button {
            background: #555;
            font-size: 10px;
            padding: 4px 8px;
            margin-left: 5px;
            border-radius: 4px;
        }

        #mobile-debug-console.minimized {
            transform: translateY(260px);
        }

        #console-logs {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            word-wrap: break-word;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #333;
            line-height: 1.4;
        }
        .log-entry.log { color: #d4d4d4; }
        .log-entry.warn { color: #fcd34d; background: rgba(251, 191, 36, 0.1); }
        .log-entry.error { color: #f87171; background: rgba(239, 68, 68, 0.1); }
        
        .timestamp {
            color: #666;
            margin-right: 8px;
            font-size: 10px;
        }
    </style>
</head>
<body>

    <h1>iOS Web Speech æ¸¬è©¦</h1>
    <p>è«‹ç¢ºä¿æ‰‹æ©Ÿæœªè™•æ–¼éœéŸ³æ¨¡å¼ï¼Œä¸¦èª¿å¤§éŸ³é‡ã€‚</p>

    <h2>1. èªéŸ³åˆæˆ (TTS)</h2>
    <input type="text" id="speech-text" value="Hello, this is a test on iOS Chrome." placeholder="è¼¸å…¥è¦æœ—è®€çš„æ–‡å­—">
    
    <div class="btn-group">
        <button class="btn-speech" onclick="speakText()">ğŸ”Š æ’­æ”¾èªéŸ³ (Speak)</button>
        <button class="btn-stop" onclick="stopSpeaking()">â¹ åœæ­¢æ’­æ”¾ (Stop)</button>
    </div>

    <h2>2. é™¤éŒ¯å·¥å…·</h2>
    <div class="btn-group">
        <button class="btn-log" onclick="checkSupport()">æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦</button>
        <button class="btn-log" onclick="listVoices()">åˆ—å‡ºå¯ç”¨èªéŸ³åŒ…</button>
    </div>

    <!-- è‡ªå®šç¾©æ§åˆ¶å° HTML çµæ§‹ -->
    <div id="mobile-debug-console">
        <div class="console-header">
            <span class="console-title">Console</span>
            <div class="console-actions">
                <button onclick="clearConsole()">Clear</button>
                <button onclick="toggleConsole()">Toggle</button>
            </div>
        </div>
        <div id="console-logs"></div>
    </div>

    <script>
        // ==========================================
        // 1. è‡ªå®šç¾©æ§åˆ¶å°é‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒ)
        // ==========================================
        (function() {
            const logContainer = document.getElementById('console-logs');
            const originalConsole = { log: console.log, warn: console.warn, error: console.error };

            function formatArgs(args) {
                return args.map(arg => {
                    if (typeof arg === 'object') {
                        try { return JSON.stringify(arg, null, 2); } catch (e) { return '[Circular Object]'; }
                    }
                    return String(arg);
                }).join(' ');
            }

            function getTime() { return new Date().toTimeString().split(' ')[0]; }

            function writeToScreen(type, args) {
                const message = formatArgs(Array.from(args));
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.innerHTML = `<span class="timestamp">[${getTime()}]</span>${message.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;')}`;
                logContainer.appendChild(entry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            console.log = function() { writeToScreen('log', arguments); originalConsole.log.apply(console, arguments); };
            console.warn = function() { writeToScreen('warn', arguments); originalConsole.warn.apply(console, arguments); };
            console.error = function() { writeToScreen('error', arguments); originalConsole.error.apply(console, arguments); };
            window.onerror = function(msg, src, line, col) { console.error(`${msg} at ${line}:${col}`); return false; };
        })();

        const consoleEl = document.getElementById('mobile-debug-console');
        const logsContainer = document.getElementById('console-logs');
        function toggleConsole() { consoleEl.classList.toggle('minimized'); }
        function clearConsole() { logsContainer.innerHTML = ''; }


        // ==========================================
        // 2. Web Speech API é‚è¼¯
        // ==========================================
        
        const synth = window.speechSynthesis;
        let voices = [];

        // è¼‰å…¥èªéŸ³åŒ… (iOS Safari/Chrome æœ‰æ™‚éœ€è¦é€™å€‹äº‹ä»¶)
        function loadVoices() {
            voices = synth.getVoices();
            console.log(`å·²è¼‰å…¥ ${voices.length} å€‹èªéŸ³åŒ…`);
        }

        // ç›£è½èªéŸ³åŒ…è®Šæ›´ (Chrome/Safari å¿…å‚™)
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // æª¢æŸ¥æ”¯æ´åº¦
        function checkSupport() {
            if ('speechSynthesis' in window) {
                console.log("âœ… æ­¤ç€è¦½å™¨æ”¯æ´ Speech Synthesis API");
            } else {
                console.error("âŒ æ­¤ç€è¦½å™¨ä¸æ”¯æ´ Speech Synthesis API");
            }
        }

        // åˆ—å‡ºèªéŸ³åŒ…
        function listVoices() {
            voices = synth.getVoices();
            if (voices.length === 0) {
                console.warn("å°šæœªåµæ¸¬åˆ°èªéŸ³åŒ…ï¼Œæˆ–æ­£åœ¨è¼‰å…¥ä¸­...");
                return;
            }
            console.log("--- å¯ç”¨èªéŸ³åˆ—è¡¨ ---");
            voices.forEach((voice, index) => {
                // åªåˆ—å‡ºå‰ 5 å€‹æˆ–åŒ…å« 'en'/'zh' çš„ï¼Œé¿å…æ´—ç‰ˆ
                if(index < 5 || voice.lang.includes('en') || voice.lang.includes('zh')) {
                    console.log(`${index}: ${voice.name} (${voice.lang})`);
                }
            });
            console.log(`(å…± ${voices.length} å€‹ï¼Œåƒ…é¡¯ç¤ºéƒ¨åˆ†)`);
        }

        // é–‹å§‹æœ—è®€
        function speakText() {
            if (synth.speaking) {
                console.warn("æ­£åœ¨èªªè©±ä¸­ï¼Œè«‹å…ˆåœæ­¢...");
                synth.cancel(); // å¼·åˆ¶ä¸­æ–·èˆŠçš„
            }

            const textInput = document.getElementById('speech-text').value;
            if (textInput === '') {
                console.warn("è«‹è¼¸å…¥æ–‡å­—");
                return;
            }

            const utterThis = new SpeechSynthesisUtterance(textInput);

            // å˜—è©¦å°‹æ‰¾é©åˆçš„èªéŸ³ (å„ªå…ˆæ‰¾ iOS çš„è‹±æ–‡æˆ–ä¸­æ–‡)
            // æ³¨æ„ï¼šiOS ä¸Šçš„èªéŸ³åç¨±é€šå¸¸åƒ "Samantha", "Daniel", "Ting-Ting"
            voices = synth.getVoices();
            
            // ç°¡å–®çš„èªéŸ³é¸æ“‡é‚è¼¯ï¼šå¦‚æœæ˜¯ä¸­æ–‡å…§å®¹é¸ä¸­æ–‡èªéŸ³ï¼Œå¦å‰‡é¸è‹±æ–‡
            const isChinese = /[\u4e00-\u9fa5]/.test(textInput);
            let selectedVoice = null;

            if (isChinese) {
                selectedVoice = voices.find(v => v.lang.includes('zh-TW') || v.lang.includes('zh-CN'));
            } else {
                selectedVoice = voices.find(v => v.lang.includes('en-US') || v.lang.includes('en-GB'));
            }

            if (selectedVoice) {
                utterThis.voice = selectedVoice;
                console.log(`ä½¿ç”¨èªéŸ³: ${selectedVoice.name}`);
            } else {
                console.log("ä½¿ç”¨ç³»çµ±é è¨­èªéŸ³");
            }

            // iOS ç‰¹å®šèª¿æ•´
            utterThis.rate = 1.0;  // èªé€Ÿ
            utterThis.pitch = 1.0; // éŸ³èª¿
            utterThis.volume = 1.0; // éŸ³é‡

            // äº‹ä»¶ç›£è½
            utterThis.onstart = function(event) {
                console.log("â–¶ï¸ é–‹å§‹æœ—è®€...");
            }

            utterThis.onend = function(event) {
                console.log("âœ… æœ—è®€çµæŸ");
            }

            utterThis.onerror = function(event) {
                console.error("âŒ æœ—è®€ç™¼ç”ŸéŒ¯èª¤: " + event.error);
            }

            // åŸ·è¡Œ
            synth.speak(utterThis);
        }

        // åœæ­¢æœ—è®€
        function stopSpeaking() {
            if (synth.speaking || synth.pending) {
                synth.cancel();
                console.log("â¹ å·²åœæ­¢æœ—è®€");
            }
        }

        // åˆå§‹åŒ–å˜—è©¦è¼‰å…¥ä¸€æ¬¡
        loadVoices();

    </script>
</body>
</html>